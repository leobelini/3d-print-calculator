const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/7NDEDZB7-CPvtfeNo.js","assets/index-CCtJbuFu.js","assets/index-DSPfHjfY.css","assets/section-BYkdblHy.js","assets/main-panel-DQJH4gdo.js","assets/goober.modern-D2HZIzZw.js","assets/store-CcMuWB6z.js"])))=>i.map(i=>d[i]);
import{c as I,b as B,d as D,e as $,f as x,o as J,g as m,h as G,i as U,l as V,_ as q,P as H,r as h,j as p,k as C}from"./index-CCtJbuFu.js";import{c as z}from"./store-CcMuWB6z.js";var lt="plugin-container",ut="plugin-title-container",A=e=>{if(e)try{return JSON.parse(e)}catch{return}},dt=e=>e.charAt(0).toUpperCase()+e.slice(1),gt=e=>{const t=[];function n(s,i){if(i===s.length-1){t.push([...s]);return}for(let o=i;o<s.length;o++)[s[i],s[o]]=[s[o],s[i]],n(s,i+1),[s[i],s[o]]=[s[o],s[i]]}return n(e,0),t},W=e=>localStorage.getItem(e),y=(e,t)=>{try{localStorage.setItem(e,t)}catch{return}},ht="tanstack_devtools",_="tanstack_devtools_state",N="tanstack_devtools_settings",ft=["Alt","Control","Meta","Shift"],w={settings:{defaultOpen:!1,hideUntilHover:!1,position:"bottom-right",panelLocation:"bottom",openHotkey:["Shift","A"],requireUrlFlag:!1,urlFlag:"tanstack-devtools",theme:typeof window<"u"&&typeof window.matchMedia<"u"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",triggerImage:"",triggerHidden:!1},state:{activeTab:"plugins",height:400,activePlugins:[],persistOpen:!1}},j=D(void 0),K=e=>{const[t,n]=$(null),s=()=>{const c=t();c!=null&&(c.close(),n(null))},i=c=>{if(t()!=null)return;const r=window.open("","TSDT-Devtools-Panel",`${c},popup`);if(!r)throw new Error("Failed to open popup. Please allow popups for this site to view the devtools in picture-in-picture mode.");window.addEventListener("beforeunload",()=>{localStorage.setItem("pip_open","false"),s()}),r.document.head.innerHTML="",r.document.body.innerHTML="",r.document.title="TanStack Devtools",r.document.body.style.margin="0",r.addEventListener("pagehide",()=>{localStorage.setItem("pip_open","false"),s()}),[...document.styleSheets].forEach(a=>{try{const u=[...a.cssRules].map(v=>v.cssText).join(""),l=document.createElement("style"),S=a.ownerNode;let f="";S&&"id"in S&&(f=S.id),f&&l.setAttribute("id",f),l.textContent=u,r.document.head.appendChild(l)}catch{const l=document.createElement("link");if(a.href==null)return;l.rel="stylesheet",l.type=a.type,l.media=a.media.toString(),l.href=a.href,r.document.head.appendChild(l)}}),G(["focusin","focusout","pointermove","keydown","pointerdown","pointerup","click","mousedown","input"],r.document),n(r)};x(()=>{const c=document.querySelector("#_goober"),r=t();if(c&&r){const a=new MutationObserver(()=>{const u=r.document.querySelector("#_goober");u&&(u.textContent=c.textContent)});a.observe(c,{childList:!0,subtree:!0,characterDataOldValue:!0}),J(()=>{a.disconnect()})}});const o=I(()=>({pipWindow:t(),requestPipWindow:i,closePipWindow:s,disabled:e.disabled??!1}));return m(j.Provider,{value:o,get children(){return e.children}})},vt=()=>I(()=>{const t=B(j);if(!t)throw new Error("usePiPWindow must be used within a PiPProvider");return t()}),X=3;function Q(e){return e.length===0?[]:e.length===1?[e[0].id]:e.filter(t=>t.defaultOpen===!0).slice(0,X).map(t=>t.id)}var Y=D(),Z=()=>{const e=W(N);return{...A(e)}},T=(e,t)=>e.id?e.id:typeof e.name=="string"?`${e.name.toLowerCase().replace(" ","-")}-${t}`:t.toString();function tt(e){const t=W(_),n=A(t),s=e?.map((i,o)=>T(i,o))||[];if(n?.activePlugins){const i=n.activePlugins.length;n.activePlugins=n.activePlugins.filter(o=>s.includes(o)),n.activePlugins.length!==i&&y(_,JSON.stringify(n))}return n}var et=(e,t)=>{const n=tt(t),s=Z(),i=t?.map((a,u)=>{const l=T(a,u);return{...a,id:l}})||[];let o=n?.activePlugins||[];return o.length===0&&i.length>0&&(o=Q(i)),{...w,plugins:i,state:{...w.state,...n,activePlugins:o},settings:{...w.settings,...e,...s}}},nt=e=>{const[t,n]=z(et(e.config,e.plugins)),s=o=>{const c=o.map((r,a)=>{const u=T(r,a);return{...r,id:u}});n("plugins",c)};x(()=>{e.onSetPlugins&&e.onSetPlugins(s)});const i={store:t,setStore:o=>{const c=o(t),{settings:r,state:a}=c;y(N,JSON.stringify(r)),y(_,JSON.stringify(a)),n(u=>({...u,...c}))}};return m(Y.Provider,{value:i,get children(){return e.children}})};function L(e){return JSON.stringify(e,(t,n)=>typeof n=="bigint"?{__type:"bigint",value:n.toString()}:n)}function k(e){return JSON.parse(e,(t,n)=>n&&typeof n=="object"&&n.__type==="bigint"&&typeof n.value=="string"?BigInt(n.value):n)}class st{#s;#t;#e;#n;#a;#i;#o;#r=t=>{const n=t.detail;this.emitToServer(n),this.emitToClients(n)};#c=()=>{this.debugLog("Connection request made to event-bus, replying back with success"),this.#n.dispatchEvent(new CustomEvent("tanstack-connect-success"))};constructor({port:t=42069,debug:n=!1,connectToServerBus:s=!1}={}){this.#a=n,this.#o=new BroadcastChannel("tanstack-devtools"),this.#e=null,this.#s=t,this.#t=null,this.#i=s,this.#n=this.getGlobalTarget(),this.#o.onmessage=i=>{this.emitToClients(k(i.data),!0)},this.debugLog("Initializing client event bus")}emitToClients(t,n=!1){this.debugLog("Emitting event from client bus",t);const s=new CustomEvent(t.type,{detail:t});this.debugLog("Emitting event to specific client listeners",t),this.#n.dispatchEvent(s);const i=new CustomEvent("tanstack-devtools-global",{detail:t});n||this.#o?.postMessage(L(t)),this.debugLog("Emitting event to global client listeners",t),this.#n.dispatchEvent(i)}emitToServer(t){const n=L(t);this.#t&&this.#t.readyState===WebSocket.OPEN?(this.debugLog("Emitting event to server via WS",t),this.#t.send(n)):this.#e&&(this.debugLog("Emitting event to server via SSE",t),fetch(`http://localhost:${this.#s}/__devtools/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:n}).catch(()=>{}))}start(){this.debugLog("Starting client event bus"),!(typeof window>"u")&&(this.#i&&this.connect(),this.#n=window,this.#n.addEventListener("tanstack-dispatch-event",this.#r),this.#n.addEventListener("tanstack-connect",this.#c))}stop(){this.debugLog("Stopping client event bus"),!(typeof window>"u")&&(this.#n.removeEventListener("tanstack-dispatch-event",this.#r),this.#n.removeEventListener("tanstack-connect",this.#c),this.#e?.close(),this.#t?.close(),this.#t=null,this.#e=null)}getGlobalTarget(){return typeof window<"u"?window:new EventTarget}debugLog(...t){this.#a&&console.log("ðŸŒ´ [tanstack-devtools:client-bus]",...t)}connectSSE(){this.debugLog("Connecting to SSE server"),this.#e=new EventSource(`http://localhost:${this.#s}/__devtools/sse`),this.#e.onmessage=t=>{this.debugLog("Received message from SSE server",t.data),this.handleEventReceived(t.data)}}connectWebSocket(){this.debugLog("Connecting to WebSocket server"),this.#t=new WebSocket(`ws://localhost:${this.#s}/__devtools/ws`),this.#t.onmessage=t=>{this.debugLog("Received message from server",t.data),this.handleEventReceived(t.data)},this.#t.onclose=()=>{this.debugLog("WebSocket connection closed"),this.#t=null},this.#t.onerror=()=>{this.debugLog("WebSocket connection error")}}connect(){try{this.connectWebSocket()}catch{if(typeof window>"u")return;this.connectSSE()}}handleEventReceived(t){try{const n=k(t);this.emitToClients(n)}catch{}}}var it=class{#s={...w.settings};#t=[];#e=!1;#n;#a;#i;#o;#r;constructor(e){this.#t=e.plugins||[],this.#o=e.eventBusConfig,this.#s={...this.#s,...e.config}}mount(e){if(this.#e)throw new Error("Devtools is already mounted");const t=e,n=U(()=>{const s=this;this.#a=V(()=>q(()=>import("./7NDEDZB7-CPvtfeNo.js"),__vite__mapDeps([0,1,2,3,4,5,6])));const i=this.#a;return this.#i=new st(this.#o),this.#i.start(),m(nt,{get plugins(){return s.#t},get config(){return s.#s},onSetPlugins:o=>{s.#r=o},get children(){return m(K,{get children(){return m(H,{mount:t,get children(){return m(i,{})}})}})}})},t);this.#e=!0,this.#n=n}unmount(){if(!this.#e)throw new Error("Devtools is not mounted");this.#i?.stop(),this.#n?.(),this.#e=!1}setConfig(e){this.#s={...this.#s,...e},e.plugins&&(this.#t=e.plugins,this.#e&&this.#r&&this.#r(e.plugins))}};const O=(e,t,n,s)=>{const i=typeof e=="function"?e(n,s):e;t(o=>({...o,[n.getAttribute("id")]:i}))},ot=({plugins:e,config:t,eventBusConfig:n})=>{const s=h.useRef(null),[i,o]=h.useState({}),[c,r]=h.useState({}),[a,u]=h.useState({}),[l,S]=h.useState({}),f=h.useMemo(()=>e?.map(g=>({...g,name:typeof g.name=="string"?g.name:(d,E)=>{const b=d.getAttribute("id");d.ownerDocument.getElementById(b)&&r(P=>({...P,[b]:d})),O(g.name,S,d,E)},render:(d,E)=>{const b=d.getAttribute("id");d.ownerDocument.getElementById(b)&&o(P=>({...P,[b]:d})),O(g.render,u,d,E)}}))??[],[e]),[v]=h.useState(()=>new it({config:t,eventBusConfig:n,plugins:f}));h.useEffect(()=>{v.setConfig({plugins:f})},[v,f]),h.useEffect(()=>(s.current&&v.mount(s.current),()=>v.unmount()),[v]);const M=Object.values(i).length>0&&Object.values(a).length>0,R=Object.values(c).length>0&&Object.values(l).length>0;return p.jsxs(p.Fragment,{children:[p.jsx("div",{style:{position:"absolute"},ref:s}),M?Object.entries(i).map(([g,d])=>C.createPortal(p.jsx(p.Fragment,{children:a[g]}),d)):null,R?Object.entries(c).map(([g,d])=>C.createPortal(p.jsx(p.Fragment,{children:l[g]}),d)):null]})},rt=ot,pt=Object.freeze(Object.defineProperty({__proto__:null,TanStackDevtools:rt},Symbol.toStringTag,{value:"Module"}));export{Y as D,X as M,ut as P,ht as T,lt as a,dt as b,gt as g,pt as i,ft as k,vt as u};
